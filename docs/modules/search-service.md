# 功能单元规格说明

## 基本信息
- **单元名称**：智能搜索服务
- **路径**：backend/app/services/search_service.py
- **类型**：API服务

## 功能描述
提供智能搜索和内容推荐功能，包括记录用户搜索历史、根据用户兴趣推荐新闻内容、支持无痕模式等功能。该服务是智能搜索模块的核心服务层，负责信息导航和内容推送。

## 接口规范
### 输入
- **搜索信息**:
  - `db`: SQLAlchemy Session - 数据库会话
  - `user_id`: str - 用户ID
  - `keyword`: str - 搜索关键词
  - `traceless`: bool - 是否为无痕搜索模式
  
- **获取搜索历史**:
  - `db`: SQLAlchemy Session - 数据库会话
  - `user_id`: str - 用户ID
  - `skip`: int (可选) - 分页起始位置，默认0
  - `limit`: int (可选) - 分页大小，默认20
  
- **删除搜索历史**:
  - `db`: SQLAlchemy Session - 数据库会话
  - `record_id`: str - 搜索记录ID
  - `user_id`: str - 用户ID
  
- **清空搜索历史**:
  - `db`: SQLAlchemy Session - 数据库会话
  - `user_id`: str - 用户ID
  
- **获取推荐新闻**:
  - `db`: SQLAlchemy Session - 数据库会话
  - `user_id`: str - 用户ID
  - `limit`: int (可选) - 返回数量，默认10
  - `categories`: List[str] (可选) - 新闻分类过滤

### 输出
- **搜索信息**: Dict - 包含搜索结果和相关推荐
- **获取搜索历史**: List[SearchRecord] - 搜索记录列表
- **删除搜索历史**: bool - 删除是否成功
- **清空搜索历史**: bool - 清空是否成功
- **获取推荐新闻**: List[News] - 新闻列表

## 依赖关系
- **数据库模型层**: 依赖app.models.search.SearchRecord和app.models.news.News模型
- **数据校验层**: 依赖app.schemas.search中的Pydantic模型
- **用户服务**: 依赖app.services.user_service获取用户偏好
- **外部API**: 依赖新闻API获取最新内容
- **搜索引擎**: 依赖第三方搜索API进行网络信息检索
- **推荐算法**: 依赖推荐算法服务生成个性化内容推荐

## 副作用
- **搜索历史**: 非无痕模式下记录用户搜索历史到数据库
- **用户画像更新**: 搜索行为会影响用户兴趣模型，从而影响后续推荐
- **外部API调用**: 搜索和推荐功能会调用第三方服务，产生网络流量和API使用计费

## 异常处理
- **搜索失败**: 处理第三方搜索API不可用的情况
- **内容推荐失败**: 处理新闻API不可用的情况
- **无搜索历史**: 处理新用户或清空历史后的冷启动推荐问题
- **敏感内容过滤**: 确保搜索结果和推荐内容不含敏感或不适当信息

## 注意事项
- **性能优化**: 搜索请求应尽可能并行处理，缩短响应时间
- **缓存机制**: 对热门搜索词和常见推荐结果进行缓存，减轻后端压力
- **个人隐私**: 严格遵守无痕模式设置，不记录用户数据
- **个性化推荐**: 根据用户历史行为和兴趣偏好，提供差异化的内容推荐
- **内容时效性**: 新闻推荐应重视内容的时效性，优先展示近期发布的高质量内容 